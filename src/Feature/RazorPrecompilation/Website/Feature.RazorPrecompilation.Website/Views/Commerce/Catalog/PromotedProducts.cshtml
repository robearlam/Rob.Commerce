
@using Sitecore.XA.Foundation.MarkupDecorator.Extensions
@using Sitecore.XA.Foundation.SitecoreExtensions.Extensions
@using Sitecore.Commerce.XA.Feature.Catalog.Models
@using Sitecore.Mvc

@model Sitecore.Commerce.XA.Feature.Catalog.Models.PromotedProductsRenderingModel
@{
    var currentItem = Html.Sitecore().CurrentItem;
    var loadMoreProductsText = Html.Sitecore().Field("Show More Products Text", currentItem);
    var loadMoreProductsTooltip = Html.Sitecore().Field("Show More Products Tooltip", currentItem);
}
<div data-bind="style: {display: 'block'}" style="display: none" @Html.Sxa().Component("cxa-promoted-products-component", Model.Attributes) data-cxa-component-class="PromotedProducts" data-cxa-component-initialized="false" data-cxa-component-type="component">
    <input type="hidden" name="currentCatalogItemId" value="@Model.CurrentCatalogItemId" data-bind="value: currentCatalogItemId" />
    <input type="hidden" name="useLazyLoading" value="@Model.UseLazyLoading" data-bind="value: useLazyLoading" />
    <input type="hidden" name="maxPageSize" value="@Model.MaxPageSize" data-bind="value: maxPageSize" />
    <input type="hidden" name="currentItemId" value="@currentItem.ID" data-bind="value: currentItemId" />
    <input type="hidden" name="productListsRawValue" value="@Model.ProductListId" data-bind="value: productListsRawValue" />
    <input type="hidden" name="relationshipId" value="@Model.RelationshipId" data-bind="value: relationshipId" />

    @if (!String.IsNullOrWhiteSpace(Model.ErrorMessage))
    {
        <div class="error-message">
            @Model.ErrorMessage
        </div>
    }
    else
    {

            <div class="product-list component-content">
                <span class="title" data-bind="text: listTitle"></span>
                <ul data-bind="foreach: productsList">
                    <li>
                        <div class="product-summary">
                            <div class="photo">
                                <a data-bind="attr:{href: Link}">
                                    <img data-bind="attr:{src: SummaryImageUrl, title: DisplayName}" alt="product image"/>
                                </a>
                            </div>

                            <div class="product-info">
                                <h4 class="product-title" data-bind="attr:{title: DisplayName}">
                                    <a data-bind="attr:{href: Link}, text: DisplayName"></a>
                                </h4>
                                <!-- ko if: Brand-->
                                <div data-bind="html: Brand" class="product-brand"></div>
                                <!-- /ko-->
                                <!-- ko ifnot: Brand-->
                                <div class="product-brand">&nbsp;</div>
                                <!-- /ko -->
                                <!-- ko ifnot: IsCategory-->
                                <!-- ko if: DisplayStartingFrom -->
                                <div class="lowest-variant-price" data-bind="html: PriceStartingFromText"></div>
                                <!-- /ko -->
                                <!-- ko if: IsOnSale-->
                                <div class="current-price on-sale" data-bind="text: AdjustedPriceWithCurrency"></div>
                                <div class="previous-price on-sale" data-bind="text: ListPriceWithCurrency"></div>
                                <div class="savings on-sale">
                                    <span class="savings-text" data-bind="html: SavePercentLead"></span>
                                    <span class="savings-percentage" data-bind="text:SavingsPercentage+'%'"></span>
                                </div>
                                <!-- /ko -->
                                <!-- ko ifnot: IsOnSale-->
                                <div class="current-price" data-bind="text: ListPriceWithCurrency"></div>
                                <div class="previous-price"></div>
                                <div class="savings"></div>
                                <div></div>
                                <!-- /ko -->
                                <!-- ko if: StockStatus -->
                                <div data-bind="text: StockStatusLabel, attr:{class: StockStatusName + ' product-stock-status'}"></div>

                                <!-- ko if: StockAvailabilityDate -->
                                <!-- TODO: Style the stock availability date-->
                                @*<div class="product-stock-availability-date" data-bind="text: '/' + StockAvailabilityDate"></div>*@
                                <!-- /ko -->
                                <!-- ko ifnot: StockAvailabilityDate -->
                                <div class="product-stock-availability-date"></div>
                                <!-- /ko -->
                                <!-- /ko -->
                                <!-- ko ifnot: StockStatus -->
                                <div class="product-stock-status">&nbsp;</div>
                                <div class="price-stock"></div>
                                <!-- /ko -->

                                <!-- ko if:IsOnSale -->
                                <div class="product-category on-sale">
                                    <a data-bind="attr:{href: Link}">
                                        <span class="icon-list"></span><span data-bind="html: ProductPageLinkText"></span>
                                    </a>
                                </div>
                                <!-- /ko -->
                                <!-- ko ifnot: IsOnSale -->
                                <div class="product-category">
                                    <a data-bind="attr:{href: Link}">
                                        <span class="icon-list"></span><span data-bind="html: ProductPageLinkText"></span>
                                    </a>
                                </div>
                                <!-- /ko -->
                                <!-- /ko -->
                                <!-- ko if: IsCategory-->
                                <!-- ko if: IsOnSale-->
                                <div class="product-category on-sale">
                                    <a data-bind="attr: {href: Link}">
                                        <span class="icon-list"></span><span data-bind="html: Category"></span>
                                    </a>
                                </div>
                                <!-- /ko -->
                                <!-- ko ifnot: IsOnSale-->
                                <div class="product-category">
                                    <a data-bind="attr: {href: Link}">
                                        <span class="icon-list"></span><span data-bind="html: Category"></span>
                                    </a>
                                </div>
                                <!-- /ko -->
                                <!-- /ko -->
                            </div>
                        </div>
                    </li>
                </ul>
                <!-- ko if: useLazyLoading -->
                <a class="load-more-btn" data-bind="click: loadProducts, visible: canLoadMoreProducts" title="@currentItem["Show More Products Tooltip"]">@loadMoreProductsText</a>
                <!-- /ko -->
            </div>
            
    }
</div>