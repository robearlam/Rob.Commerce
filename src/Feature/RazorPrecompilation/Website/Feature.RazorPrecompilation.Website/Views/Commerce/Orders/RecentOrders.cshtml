@using System.Web.Mvc.Ajax
@using System.Web.Mvc.Html
@using Sitecore.Commerce.XA.Feature.Account
@using Sitecore.Commerce.XA.Feature.Account.Models
@using Sitecore.Mvc
@using Sitecore.XA.Foundation.MarkupDecorator.Extensions
@using Sitecore.XA.Foundation.SitecoreExtensions.Extensions
@using ComponentDataSource = Sitecore.Commerce.XA.Feature.Account.AccountFeatureConstants.Orders.RecentOrders.DataSourceFields
@model RecentOrdersRenderingModel


<div @Html.Sxa().Component("cxa-recentorders-component", Model.Attributes) data-cxa-component-class="RecentOrders" data-cxa-component-initialized="false" data-cxa-component-model="OrdersViewModel" data-cxa-component-type="component">
    @if (!String.IsNullOrWhiteSpace(Model.ErrorMessage))
    {
        <div class="error-message">
            <p>@Model.ErrorMessage</p>
        </div>
    }
    else
    {
        <div class="component-content">
            <div class="header">
                <h4 title="@Model.TitleTooltip">
                    @Html.Sitecore().Field(ComponentDataSource.TitleMessage, Html.Sitecore().CurrentItem)
                </h4>
                <a href="@Model.ViewAllOrdersLink" class="view-all-orders-link" title="@Model.ViewAllOrdersLinkTooltip">@Html.Sitecore().Field(ComponentDataSource.ViewAllOrdersLabel, Html.Sitecore().CurrentItem)</a>
            </div>
            <div class="recent-orders-list" data-max-rows="@Model.NumberOfDisplayedOrders">
                <table>
                    <thead>
                        <tr>
                            <td title="@Model.OrderIdColumnHeaderTooltip">@Html.Sitecore().Field(ComponentDataSource.OrdersIdColumnHeaderText, Html.Sitecore().CurrentItem)</td>
                            <td title="@Model.OrderStatusColumnHeaderTooltip">@Html.Sitecore().Field(ComponentDataSource.OrderStatusColumnHeaderText, Html.Sitecore().CurrentItem)</td>
                            <td title="@Model.DateColumnHeaderTooltip">@Html.Sitecore().Field(ComponentDataSource.DateColumnHeaderText, Html.Sitecore().CurrentItem)</td>
                            <td class="view-order-details" title="@Model.ViewDetailsHeaderColumnTooltip"></td>
                        </tr>
                    </thead>
                    <tbody data-bind="visible: !(orders().length)">
                        <tr>
                            <td colspan="10" class="text-center">@Html.Sitecore().CurrentItem["No Order Message"]</td>
                        </tr>
                    </tbody>
                    <tbody data-bind="foreach: orders">
                        <tr>
                            <td class="order-id"><a data-bind="attr:{ href: '@Model.OrderDetailsLink' +'?id=' + externalId() }, text: orderId"></a></td>
                            <td class="status"><a data-bind="attr:{ href: '@Model.OrderDetailsLink' +'?id=' + externalId() }, text: status"></a></td>
                            <td class="order-date"><a data-bind="attr:{ href: '@Model.OrderDetailsLink' +'?id=' + externalId() }, text: orderDate"></a></td>
                            <td class="view-details"><a data-bind="attr:{ href: '@Model.OrderDetailsLink' +'?id=' + externalId() }"><span class="view-order-details-button"></span></a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>
